---
title: "统计软件期末作业"
author: "刘凯祥2019202134"
date: "`r Sys.Date()`"
output:
  rmdformats::readthedown:
    toc_depth: 4
---

<style type="text/css">

body{ /* Normal  */
  font-size: 16px;
  font-family: "FangSong", "Times New Roman", Times, serif;
}

td {  /* Table  */
  font-size: 8px;
}
h1.title {
  font-size: 32px;
  font-family: "KaiTi", Times, serif;
  color: DarkRed;
}
h1 { /* Header 1 */
  font-size: 26px;
  font-family: "KaiTi", Times, serif;
  color: DarkBlue;
}
h2 { /* Header 2 */
  font-size: 22px;
  font-family: "KaiTi", Times, serif;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 18px;
  font-family: "KaiTi", Times, serif;
  color: DarkBlue;
}

h4 { /* Header 3 */
  font-size: 18px;
  font-family: "KaiTi", Times, serif;
  color: DarkBlue;
}

code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r}
library(magrittr)
library(tidyverse)
library(kableExtra)
library(broom)
library(plyr)
library(caret)
library(DT)
library(lubridate)
library(lmtest)
library(car)
```

**期末作业整体思路**

- **数据读入及预处理**：由于数据并没有缺失值，故在数据预处理部分着重考虑了是否有异常数据，是否有重复数据等问题；

- **生成衍生变量**：在原有变量的基础上，联系实际经历，生成了“创作年份”、“歌单介绍字数”、“是否含有热门标签”等三个衍生变量并用于后续建模中。在第二部分将会详细介绍各衍生变量的灵感来源，含义以及生成思路；

- **重要变量描述分析**：描述分析是正式建模之前很重要的一环，可以帮助我们更进一步地了解数据，为正式建模分析提供方向上的指引。经过相关系数热力图等数据分析之后，最终挑选出收藏数、分享数、创建年份以及是否含有热门标签这四个重要自变量进行描述分析；

- **回归建模**：在回归建模部分，首先是用原始数据建立全模型并进行一系列的模型诊断，发现有较严重的异方差等问题。因此，依据描述分析结果，采取了对因变量及部分连续型自变量取对数的处理，重新建立回归模型。最终有效的解决了异方差等问题，调整后的$R^2$更是高达**0.9184**。进一步地，分别通过AIC以及BIC进行变量选择，依据调整后的$R^2$以及变量个数等指标最终选择AIC模型为最终模型，调整后的$R^2$为**0.9186**。

- 最终，经过一系列分析，最终得出的影响云音乐播放量的主要因素有：创作年份、是否含有热门标签、收藏数、分享数、歌曲列表数目、歌单介绍字数以及歌单名中是否含有部分词。

# 1. 数据读入及预处理

## 1.1 读入数据

```{r}
#读入数据
data <- read.csv('./music.csv', fileEncoding = 'utf-8',stringsAsFactors = FALSE)

#查看前6条数据
kable(head(data),'html')%>%
  kable_styling(bootstrap_options = c("striped", "hover"))%>%
  scroll_box(width = "800px", height = "300px")

#查看数据总体情况
summary(data)
```

**summary结果分析**：

- 共有2049条数据，且无缺失数据。

- 其中绝大多数变量为字符型变量，而create_time、play_count等7个变量为数值型变量。其中comment_count变量最小值为0，需要在之后对变量进行对数处理时格外注意。

## 1.2 数据预处理

**思路**：

&emsp;&emsp;虽然原始数据不存在缺失值，但可能会存在一些重复值以及因变量的异常值，同时原始数据中创建时间这一变量的编码格式不易辨识和比较，需要转换。故，在数据预处理部分主要对创建时间、重复值、异常值等问题进行处理。

### (1) 创建时间处理

- 由于创建时间全部为整数，经过分析发现是以1970年1月1日为起始时间进行转换后得到的一系列整数值。因而，以1970年1月1日为起始时间，利用POSIXct函数进行转换。之后也利用了部分歌单介绍中提到的创建时间验证了此点。

```{r results='hold'}
#处理日期数据
data$create_time <- as.POSIXct(data$create_time,origin="1970-01-01")
#查看前6条数据
kable(head(data),'html')%>%
  kable_styling(bootstrap_options = c("striped", "hover"))%>%
  scroll_box(width = "800px", height = "300px")

#查看时间跨度
paste0("歌单最早创建时间：",min(data$create_time))
paste0("歌单最晚创建时间：",max(data$create_time))
```

- 通过时间转换后，可以发现最早的歌单创建时间为2013年1月11日，最晚的歌单创建时间为2017年7月19日，时间跨度较长。

### (2) 重复值处理

- 在正式进行分析之前，需要查看数据中是否存在重复数据，若有完全一样的数据，则剔除重复数据。最终剔除三条数据

```{r}
#查看重复数据，发现有三条重复数据
kable(data[which(duplicated(data)),],'html')%>%
  kable_styling(bootstrap_options = c("striped", "hover"))%>%
  scroll_box(width = "800px", height = "300px")

#剔除重复数据
data <- data[-which(duplicated(data)),]
```


### (3) 异常值处理

- 异常值普遍存在于很多分析问题当中，其可能很大程度地影响到最终的结果，因而需要格外注意异常值。异常值的处理方法有很多种，一种最简单粗暴的方法即是直接剔除。但实际上，异常值中往往包含着特殊信息，这类信息是一般数据中并不包含的，如果多加分析可能会有意外的收获。因而，在正式分析之前，通过查看因变量的分布情况来判定数据中存在的异常值，并查看其中部分异常值的数据情况。

```{r}
##查看因变量分布情况##
par(mfrow=c(1,2))

#首先查看因变量歌单播放量原始分布
hist(data$play_count,main="播放量分布直方图",xlab="播放量",ylab="频数")
axis(side=2,at=seq(0,2000,500), las = 0) #调整坐标轴

#为了查看异常值，选择绘制播放量分布箱线图。又由于因变量分布呈现明显的右偏分布，故此处绘制播放量对数值分布箱线图
boxplot(log(data$play_count),main="播放量（对数值）分布箱线图",xlab="播放量（取对数）",ylab="播放量对数值")
```


- 通过左边的直方图可以发现歌单播放量呈现明显的右偏分布。

- 通过右边的箱线图，可以看出播放量有很多潜在的异常值。为此，以最大值和最小值为例查看异常值的情况，并以此决定如何处理异常值。

```{r}
#输出播放量最高的歌单信息以及播放量最低的歌单信息
data[c(which(data$play_count==max(data$play_count)),which(data$play_count==min(data$play_count))),] %>%
  kable(.,'html')%>%
  kable_styling(bootstrap_options = c("striped", "hover"))%>%
  scroll_box(width = "800px", height = "300px")
```


- 第一行为播放量最高的歌单信息，第二行为播放量最低的歌单信息。

- 播放量最高的歌单：该歌单名为“周杰伦最全演唱正序集”，播放量超过了3千万！进一步地，通过查看该条数据的其他列信息，发现此条歌单收集了网易云收录的**周杰伦**所演唱的**所有**歌曲，不论是收藏数还是分享数等指标也都很高。相信在“周董”的吸引力下，此歌单获得如此高的播放量也是可以理解的。

- 播放量最低的歌单：该歌单名为“farewell”，播放量为49。进一步地，通过仔细阅读该歌单的介绍，可以发现该歌单创建于2017年2月11日（进一步验证了时间转换的正确性），为初三学生党自己创建的歌单。在介绍中，创建人坦诚“本歌单加上写这段话总共半小时左右，所以不要对歌单排班抱有期待(笑)但歌的质量总体还不错。”由此可以看出此条歌单播放量低也是有一定原因的。

- 最终，经过详细的分析，决定并不直接删除这些异常值，而是保留并用于后续的建模分析当中。

# 2. 生成衍生变量

- 虽然原始数据中已经有很多变量，但其中有很多变量，例如introduction（歌单介绍）等无法直接使用。另外，虽然已有变量已经很多，但可能还是会存在遗漏重要变量的问题。因此，结合原始数据，重新生成了三个衍生变量，分别为：创建年份、歌单介绍字数以及是否含有热门标签。

## 2.1 创建年份

- **灵感来源**：正常来说，对于两个歌曲质量等方面水平相近的歌单，往往一个歌单创建的时间越早，其播放量可能也就相应会越高。因此，我认为创建年份可能是一个在控制其他变量不变的情况下显著影响因变量歌单播放量的一个重要因素。
  
- **含义**：因子型变量，一共有2013、2014，2015、2016、2017五个水平，以2013年为基准组。每一个歌单依据其创建时间划分到相应的水平中。
  
- **生成思路**：由于歌单最早创建时间为2013年1月11日，最晚为2017年7月19日，时间跨度大约为5年，故首先以每月为单位绘制每月歌单创建数量分布直方图。结合因子水平、样本数量分布等方面，最终决定以年为单位进行划分，即每一个歌单依据其创建时间划分到相应的水平之中。
  
```{r}
hist(data$create_time,breaks="months",las=2,main="歌单创建时间按月分布直方图",cex.axis=0.7,xlab="",ylab="密度",col="skyblue")
#取年份作为分类标准
data$time <- data$create_time %>%
                year(.) %>% #提取年份
                as.factor(.) %>% #转换为因子型
                relevel(.,ref="2013") #设定基准组为2013年
```

## 2.2 歌单介绍字数

- **灵感来源**：在互联网时代碎片化的影响下，大量用户往往不再会认真阅读很长的歌单介绍。因此一个言简意赅，能很快让用户抓住重点的歌单介绍才是一个好的介绍。而一个较长的歌单介绍却可能由于用户没有耐心读完，抓不住重点，最终适得其反。
  
- **含义**：数值型变量，为每个歌单的介绍内容所含字符数（字符数统计时包含了标点符号）。
  
- **生成思路**：由于原始歌单的介绍包含\<br>等网页源码，所以在正式统计之前需要通过字符串处理方法去除无关的网页代码。通过分析，发现introduction中的字符串格式较规范，开头处是“\<b>介绍：\</b>”，中间的分隔符为\<br>。因此，可以通过在开头处统一去掉“\<b>介绍：\</b>”，另外将所有的\<br>都替换为空字符串，最终通过nchar函数统计出歌单介绍的字符数。
  
```{r}
#删除多余字符串，并统计字符串长度
data$intro_length <- gsub("<b>介绍：</b>","",data$introduction) %>%
            gsub("<br>","",.) %>% nchar(.)

#通过绘制歌单介绍字数取对数前以及取对数后的直方图观察歌单介绍字数的分布
par(mfrow=c(1,2))
hist(data$intro_length,main="歌单介绍字数分布直方图",xlab="歌单介绍字数",ylab="频数",yaxt="n")
axis(side=2,at=seq(0,1400,200),las=1) #调整坐标轴

hist(log(data$intro_length),main="歌单介绍字数对数值分布直方图",xlab="歌单介绍字数对数值",ylab="频数",yaxt="n")
axis(side=2,at=seq(0,500,100), las = 1) #调整坐标轴
```

- 通过两幅图可以发现，歌单介绍字数呈现明显的右偏分布，其中绝大多数歌单介绍字数都在100字以下。对歌单介绍字数取对数之后偏态分布得到很大的改善。

## 2.3 是否含有热门标签

- **灵感来源**：对于原始数据的Topics变量最原始的处理想法是依据有多少种不同的标签，则对应生成一个个相应的哑变量（取值为0，1）。但，经过最终的统计，大约有70多个不同的标签，因而此种方法将生成大量的虚拟变量，并且各变量之间的样本数量存在着严重的不均衡。因此，联系现实，最终考虑用不同的方法去利用Topics这一变量信息生成有用的衍生变量。在现实中，往往有一些标签会出现在很多歌单中，例如“欧美”、“驾车”等，而有些标签则很少出现在众多的歌单之中，例如“New?Age”。由此可以认为，那些出现频次较高的标签是绝大部分歌单选择的“热门标签”，而那些出现频次很少的标签则是相对的“冷门标签”。结合日常听歌经历，“热门标签”中的歌单可能更加符合大众口味，更加能够吸引到用户，相应的则会相较于“冷门标签”获得更高的播放量。因此，我认为，一个歌单中是否含有“热门标签”（通过出现频数进行定义）可能是一个影响歌单播放量的重要因素。
  
- **含义**：热门标签指的是全部歌单数据中那些出现频次高于某一特定值的标签。而是否含有热门标签这一变量是取值为“是”与“否”的因子型变量，基准组是“否”。若该变量取值是“是”，则表明此歌单中包含的所有标签里含有热门标签。
  
- **生成思路**：首先从Topics变量中提取出一个个标签，例如"欧美"、"驾车"等，之后对所有的标签进行分组统计，并绘制频数取值分布箱线图，最终确定频数划分界限为200。即当一个标签出现频数高于200时认为其是热门标签，否则则不是热门标签。提取出热门标签之后，在原始数据中新增一列hot_topics（初始值为"否"），进一步通过相应的查找函数确定每个歌单中是否存在热门标签，若存在则值修改为"是"。
  
```{r}
###处理Topics(标签)变量###

#由于字符串起始和末尾分别是"["和”]"，所以首先通过substring函数去除起始和末尾的字符。进一步地，依据","分隔符进行字符串分割
topic <- substring(data$topics,2,nchar(data$topics)-1) %>% strsplit(.,split = ",")

#由于分割后的每个词还存在着一个双引号，所以进一步通过循环将每一个词的双引号去掉，原理与在开始处去掉"["和”]"相同
for(i in 1:length(data$topics)){
  for(j in 1:length(topic[[i]])){ #依次取出每一个标签
    topic[[i]][j] <- substring(topic[[i]][j],2,nchar(topic[[i]][j])-1) #去除引号
  }
}

#接下来，为了统计每一个标签出现的频数，首先将之前存在list中的所有标签全部存入temp变量（列表）中。最后通过table函数进行分组统计
temp <- list()

ind <- 1 #标记当前存储位置
for(i in 1:length(data$topics)){
  for(j in 1:length(topic[[i]])){
    temp$topic[ind] <- topic[[i]][j] #将每一个词都存入temp临时变量中，同时为该列取名为topic
    ind <- ind + 1
  }
}

##对主题进行分组统计，结果存入topics_aggr
topics_aggr <- as.data.frame(temp) %>% table(.) %>% as.data.frame(.)
#修改列名
colnames(topics_aggr) <- c("topics","freq")

#展示最终分组汇总统计结果
datatable(topics_aggr)
```

- 可以看到其中有些标签出现频次较低，而“欧美”这一标签则出现频次很高，出现了超过500次。

```{r}
#绘制每个主题的频数分布箱线图，最后根据频数分布选择200为界
boxplot(topics_aggr$freq,main="各标签频数分布箱线图",xlab="标签",ylab="频数")
```

- 通过频数分布箱线图可以看出，绝大多数标签的出现频次都在200以下，只有少部分的标签出现频数在200以上，因而频次能够超过200的标签可以称得上是“热门标签”。最终，选择以出现频次200为界，出现频次高于200的标签定义为热门标签，反之则为不热门标签。

```{r}
#以200为界挑选出热门标签，并存储在一个向量中，方便之后检索
hot_topics <- as.vector(topics_aggr[which(topics_aggr$freq>200),1])

##以下是实现判断每个歌单是否包含热门标签的算法##

#首先在原始的数据集中新添加一列用以存储该歌单是否包含热门标签的信息，初始值全部定义为“否”，即不存在热门标签。
data$hot_topics <- "否"

#接下来通过循环拿出原始歌单中的每一个标签，并判断此标签是否是热门标签，若是，则判定该歌单含有热门标签并跳转到下一个歌单的判断当中
for(i in 1:length(data$topics)){
  for(j in 1:length(topic[[i]])){#topic的第i行存储的是第i个歌单的所有标签
    if(topic[[i]][j] %in% hot_topics){ #第i个歌单含有热门标签
      data$hot_topics[i] <- "是" 
      break 
    }
  }
}
```


# 3. 重要变量描述分析（共4个）

## 相关系数热力图

- 为了更加客观的找到最重要的4个变量，首先利用数值型变量绘制相关系数热力图

```{r}
par(mfrow=c(1,1))
heatmap(cor(data[,c(5:8,10,11)]))
```

- 通过热力图可以看出自变量中的收藏数，分享数，评论数与因变量播放数之间存在着很强的相关关系，因而这三个变量应当是较为重要的变量。但由于收藏数、分享数、评论数三者之间本身也存在着很强的相关关系，因而此三个变量之间可能存在着一定程度的多重共线性问题。因此，对于这三个变量，仅挑选其中与因变量之间热力值最高的收藏数和分享数进行描述分析。

- 另外，从个人分析的视角来看，之前生成的三个衍生变量也应当是很重要的影响因素。但相较而言，我认为创建年份和是否含有热门标签这两个衍生变量比歌单介绍字数这一变量更加重要。

- 最终，挑选出收藏数、分享数、创建年份以及是否含有热门标签这四个重要自变量进行描述分析。

## 3.1 收藏数

- 对于收藏数，分别绘制了核密度图以及播放量（对数值）与收藏数（对数值）之间的散点图

```{r}
#绘制收藏数（对数值）核密度图
d <- density(log(data$collect_count+1))
plot(d, main="收藏数（对数值）核密度图")
polygon(d, col="skyblue", border="green")
```

- 收藏数（对数值）核密度图：通过核密度图可以看出收藏数的对数值基本呈现出一个正态分布，大约在对数值为9时取到概率最大值。

```{r}
#绘制播放量（对数值）与收藏数（对数值）之间散点图
plot(log(data$collect_count+1),log(data$play_count+1),main="播放量（对数值）VS.收藏数（对数值）散点图", xlab="收藏数（对数值）",ylab="播放量（对数值）",size=0.2,alpha=0.2,pch='x',col='skyblue')
```

- 播放量（对数值）VS.收藏数（对数值）散点图：通过绘制散点图可以发现，播放量对数值以及收藏数对数值之间有较强的正相关关系，这也进一步证明了此变量是一个重要自变量，也与现实相符。一般来说，选择收藏歌单的人往往都会重复去听不止一遍，并且更有可能将歌单推荐给别人，因此在控制其他因素不变的情况下，收藏数的增加会一定程度上带来歌单播放量的增加。

## 3.2 分享数

- 对于分享数，分别绘制了核密度图以及播放量（对数值）与分享数（对数值）之间的散点图

```{r}
#绘制分享数（对数值）核密度图
d <- density(log(data$share_count+1))
plot(d, main="分享数（对数值）核密度图")
polygon(d, col="skyblue", border="green")
```

- 分享数（对数值）核密度图：类似收藏数（对数值）核密度图，分享数的对数值也基本呈现正态分布，大约在对数值为4时取到概率最大值。

```{r}
#绘制播放量（对数值）与分享数（对数值）之间散点图
plot(log(data$share_count+1),log(data$play_count+1),main="播放量（对数值）VS.分享数（对数值）散点图", xlab="分享数对数值",ylab="播放量对数值",size=0.2,alpha=0.2,pch='x',col='skyblue')
```

- 播放量（对数值）VS.分享数（对数值）散点图：通过绘制散点图可以发现，播放量对数值以及分享数对数值之间同样有较强的正相关关系，也说明此变量是一个重要自变量，也与现实相符。一般来说，在控制其他因素不变的情况下，一个歌单被分享的次数越多，其播放量往往也会越高。

## 3.3 创建年份

- 对于创建年份，绘制了不同年份播放量（对数值）分布对比箱线图，其中箱体的宽度反映样本量的多少

```{r}
boxplot(log(play_count)~time,data=data,main="不同年份播放量（对数值）分布对比箱线图",xlab="创建年份",ylab="播放量（对数值）",col=heat.colors(5,alpha = 0.2),varwidth=T)
```

- 从箱体宽度来看，由于数据只截取到2017年7月份，所以2017年的歌单数并不是很高。但逐年来看，2013-2015年歌单创建数量逐年上升，而2015年之后歌单创建数量则有所下降。

- 对比不同年份的歌单播放量，发现不同年份的歌单播放量有逐年递增的趋势，这与之前生成此衍生变量时的设想有所不同，并不是歌单创建越早，播放量就越高。进一步分析，可能原因是，云音乐近几年才逐渐火爆，不论是数量还是质量都较前些年有了很大的提升。因此，可能由于数据来源的歌单在15年之前的歌单质量并不是很好，参与受众也不是很多。而近几年，越来越多的人选择听云音乐，云音乐的受众群体变广，人数变多，“风口”的到来使得16年及之后的歌单播放量水平相较于前几年有了明显的提升。

## 3.4 是否含有热门标签

- 绘制“是否含有热门标签下播放量（对数值）分布对比箱线图”，其中箱体宽度反映了样本量的多少

```{r}
boxplot(log(play_count)~hot_topics,data=data,main="是否含有热门标签下播放量（对数值）分布对比箱线图",xlab="是否含有热门标签",ylab="播放量（对数值）",col=heat.colors(2,alpha = 0.2),varwidth=T)
```

- 从箱体宽度来看，含有热门标签的歌单数要高于不含有热门标签的歌单数

- 从播放量分布水平来看，与预期相符，即含有热门标签的歌单播放量相较于不含有热门标签的歌单有着更高的播放量。这也说明热门标签的受众群体更广，更有可能收获更高的播放量。

&emsp;&emsp;**在经过数据预处理以及描述分析之后，接下来正式进入回归建模阶段。**

# 4. 回归建模

**建模思路**：

- 首先建立全模型，之后对全模型进行异方差、自相关、多重共线性等模型诊断，若有相应问题，则依次解决。在诊断完成之后，则通过AIC和BIC准则进行变量选择。在变量选择之后再次诊断模型是否存在异方差、自相关、多重共线性等问题，若有，则还需要进一步消除。如此进行下去，直到最终得到一个较优的模型并对此模型进行详尽的解释。

## 4.1 全模型

- 建立全模型

```{r}
#由于有一些纯文本信息的列无法放入回归模型中，因此此处首先删去原始数据中的一些没法用于回归建模的列，最终得到用于回归建模的数据"model_data"
model_data <- data[-c(1:4,9)]#去掉不用的列

#建立全模型，并查看模型汇总结果
fit <- lm(model_data$play_count~.,data = model_data)
summary(fit)
```

- 全模型的调整后$R^2_a = 0.8857$，拟合优度较好，也说明现有变量已经可以较好的解释因变量歌单播放量的变化了。

- 然而，观察各变量前的系数，可以发现很多变量前的系数很大，并且有很多变量其实并不显著。因此，后续还有很多需要进一步处理的内容。

## 4.2 模型诊断

```{r}
par(mfrow=c(2,2))
plot(fit)
```

- 从左边的两幅残差图中可以看出存在明显的异方差问题；

- 从Q-Q图可以看出，正态性也并不满足；

- 从cook距离图可以看出，存在着一些异常值；

- 总的来看，虽然全模型$R^2$较高，但存在着很多的问题，需要进一步改善。

### (1) 异方差问题

- 通过之前的残差图可以明显看到模型存在着严重的异方差问题，为了解决异方差问题，首先采取取对数的处理方式。经过分析，如果仅对因变量取对数，那么$R^2$仅有0.38左右，并且异方差问题会更加严重（此处不再放此模型结果）。因此，采取对因变量与部分连续自变量均取对数的处理方式。

```{r}
#对数模型
fit <- lm(log(play_count+1)~.-collect_count-share_count-comment_count-fans-playlists-intro_length+log(collect_count+1)+log(share_count+1)+log(comment_count+1)+log(fans+1)+log(playlists+1)+log(intro_length+1),data = model_data) #首先删去收藏数等变量，之后取对数后再添加进去

#查看模型汇总结果
summary(fit)
```

- 取对数之后的模型调整后$R^2_a = 0.9184$，拟合优度较全模型有了一定程度的提高。进一步，诊断此时的模型是否还存在着异方差问题。

```{r}
par(mfrow=c(2,2))
plot(fit)
```

- 可以看出，经过对数处理之后，模型的异方差问题、正态性问题以及异常值问题均得到了很好的解决，模型基本不存在异方差问题。

### (2) 自相关问题

- 根据DW检验结果，认为存在自相关问题。然而DW检验是一个小样本方法，所以在这个数据量（2000多样本）方面并不可信。同时，此数据的顺序并不是时间顺序，即不是时间序列数据，因此可以暂时不考虑自相关问题。

```{r}
dwtest(fit)
```

### (3) 多重共线性问题

- 通过方差膨胀因子法判断模型是否存在多重共线性问题

```{r}
kable(vif(fit,digits=3), "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(width = "600px", height = "250px")
```

- 所有的VIF值均小于10，可以认为模型不存在多重共线性问题

## 4.3 变量选择

- 在模型诊断之后，分别利用AIC以及BIC准则进行变量选择，并从中选择最终模型

### (1) AIC准则

```{r}
fit_AIC <- step(fit,direction = "both", trace=0, k=2)#不输出选择过程

#查看AIC选择出的模型结果
summary(fit_AIC)
```


```{r}
#绘制模型诊断图
par(mfrow=c(2,2))
plot(fit_AIC)
```

- 可以看到AIC模型基本没有异方差等问题

### (2) BIC准则

```{r}
fit_BIC <- step(fit,direction = "both", trace=0, k=log(nrow(data))) #不输出选择过程
summary(fit_BIC)
```

```{r}
par(mfrow=c(2,2))
plot(fit_BIC)
```

- 可以看到BIC模型基本没有异方差等问题。


**对比分析AIC模型及BIC模型结果**

- 取对数后模型的调整后$R^2_a=0.9184$，AIC模型调整后$R^2_a=0.9186$，BIC模型调整后$R^2_a=0.9181$。

- 由于AIC模型的调整后$R^2_a$相较于取对数后的模型有所提升，而BIC模型的调整后$R^2_a$则低于取对数后的模型。同时AIC模型也保留了各重要变量，故**选择AIC模型为最终模型**。


## 4.4 模型解释

- 以下分别输出AIC模型的原始结果和经过tidy函数处理后的系数结果

```{r}
#输出AIC准则下模型结果
summary(fit_AIC)

#经过tidy函数处理后的系数结果
kable(tidy(fit_AIC), "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover")) %>%
  scroll_box(width = "600px", height = "250px")
```

**系数解释**：

- 对于连续变量，以收藏数为例：

  - 在控制其他因素不变的情况下，收藏数每增加1%，则播放量相应会增加0.786%；（此处为弹性模型的解释方法）
  
- 对于离散变量，以是否含有热门标签为例：

  - 在控制其他因素不变的情况下，含有热门标签比不含有热门标签的歌单，播放量会平均高出7.2%；（此处为半弹性模型及含有离散自变量时的解释方法）
  
**变量解释**：

- **歌单名中是否含有一些词**：通过系数前的符号可以看出，一些词可以吸引到人眼球，从而提高歌单播放量，例如经典、节奏、欧美等；而有一些词则可能带来相反的效果，例如古风、爵士、东方等。这也提醒我们在选择歌单名时要有所注意，如果想要提高播放量的话还是需要选取一些意思相近但吸引人眼球的词。

- **创建时间**：以2013年为基准组，2014年以及2015年出现一种负效应，而2016年与2017年则产生一种正效应，尤其是2017年前的系数有0.217，意味着2017年的歌单播放量平均相较于2013年歌单播放量提高了约21.7%（控制其他因素不变时）。这也说明当今时代迎来了云音乐的“风口”，大家也可以趁着这个机会抓紧创建歌单，收获很高的播放量!

- **是否含有热门标签**：含有热门标签相较于不含有热门标签平均会提高7.3%的播放量（控制其他因素不变时），所以大家在选择标签的时候还是需要结合自己歌单的风格尽量挑选一些相近的热门标签。（具体有哪些热门标签已在之前代码中输出）

- **收藏数与分享数**：根据结果和常识，这两个变量是影响歌单播放量的很重要的因素。一个歌单如果被收藏和分享的次数很多，也意味着这个歌单有着很高的质量和贴近大众的口味，因而也更有可能收获更高的播放量；

- **歌曲列表数目**：此变量之前的系数为负值，这提示我们一个歌单并不是歌曲数越多越好，可能在碎片化时代用户更喜欢歌曲数少但是高质量的歌单；

- **歌单介绍字数**：此变量之前的系数亦为负值，表明在互联网时代碎片化的影响下，大量用户往往不再会认真阅读很长的歌单介绍。因此一个言简意赅，能很快让用户抓住重点的歌单介绍才是一个好的介绍。

